include ../VM-L431/hwdef.inc

define CAN_APP_NODE_NAME "com.vimdrones.bms"

# Serial ports
SERIAL_ORDER EMPTY USART1
PA9 USART1_TX USART1
PA10 USART1_RX USART1

STDOUT_SERIAL SD1
STDOUT_BAUDRATE 57600

# enable battery monitor
define AP_PERIPH_BATTERY_ENABLED 1
define AP_BATTERY_TIBQ76952_ENABLED 1
define AP_BATTERY_TIBQ76952_SPI_DEVICE "tibq76952"
define HAL_BATT_MONITOR_DEFAULT 32
define AP_PERIPH_BATTERY_MODEL_NAME "VM-L431-BMS"

# SPI1 for TI BMS chip
PB3 SPI1_SCK SPI1
PB4 SPI1_MISO SPI1
PB5 SPI1_MOSI SPI1
PA15 TIBQ76952_CS CS
#PB7 TIBQ76952_RST_SHUT OUTPUT 
#PA1 TIBQ76952_ALERT INPUT 

# SPI device table
SPIDEV tibq76952 SPI1 DEVID1 TIBQ76952_CS MODE0 1*MHZ 2*MHZ

# LEDs
PA3 LED1 OUTPUT OPENDRAIN GPIO(1) HIGH
PA4 LED2 OUTPUT OPENDRAIN GPIO(2) HIGH
PA5 LED3 OUTPUT OPENDRAIN GPIO(3) HIGH
PA6 LED4 OUTPUT OPENDRAIN GPIO(4) HIGH
PA7 LED5 OUTPUT OPENDRAIN GPIO(5) HIGH
PB0 LED6 OUTPUT OPENDRAIN GPIO(6) HIGH
PB1 LED7 OUTPUT OPENDRAIN GPIO(7) HIGH
PA8 LED8 OUTPUT OPENDRAIN GPIO(8) HIGH
define HAL_GPIO_PIN_BMS_LED1 1
define HAL_GPIO_PIN_BMS_LED2 2
define HAL_GPIO_PIN_BMS_LED3 3
define HAL_GPIO_PIN_BMS_LED4 4
define HAL_GPIO_PIN_BMS_LED5 5
define HAL_GPIO_PIN_BMS_LED6 6
define HAL_GPIO_PIN_BMS_LED7 7
define HAL_GPIO_PIN_BMS_LED8 8

# Buttons
PA2 BTN1 INPUT PULLUP GPIO(9) 
define HAL_GPIO_PIN_BMS_BTN1 9

define HAL_USE_ADC FALSE
define STM32_ADC_USE_ADC1 FALSE
define HAL_DISABLE_ADC_DRIVER TRUE

define AP_PERIPH_BATTERY_TAG_ENABLED 1
define AP_PERIPH_BATTERY_BMS_ENABLED 1
define AP_PERIPH_RTC_ENABLED 1
define AP_PERIPH_RTC_GLOBALTIME_ENABLED 1
